# Chrome拡張機能 開発プロジェクト管理ファイル (GEMINI.md)

---

## 1. プロジェクト基本情報

### 1.1. プロジェクト概要
* **目的**: 学術論文などのPDFに対し、著者名・発行年・タイトルを基に最適なファイル名を自動生成し、管理を容易にするChrome拡張機能を開発する。
* **成果物**: Manifest V3 ベースのChrome拡張機能

### 1.2. 学習目標
* Chrome拡張機能開発の一連のプロセス（企画、設計、実装、デバッグ）を実践的に学ぶ。
* API連携、セキュリティ、UI/UX設計など、実践的なWeb開発スキルを習得する。
* プロジェクトマネジメントの視点を養い、技術的な意思決定能力を高める。

---

## 2. あなたについて (クライアント情報)

* **プログラミング経験**: 初心者（現在、意欲的に学習中）
* **これまでの経験 (本プロジェクト内)**:
    * メンター（Gemini）のサポートを受けながら、Manifest V3ベースのプロトタイプを構築。
    * その過程で、以下の技術要素に触れ、概念的な理解を深めています。（注: 全てを完璧に理解しているわけではなく、サポートを受けながら学習中の段階です）
        * `background.js` (Service Worker) と `offscreen.js` の役割分担
        * `fetch` を用いた外部APIとの非同期通信
        * `pdf.js` ライブラリの導入と基本的なテキスト抽出処理
* **学習スタイル**:
    * 実装の主導権は自身で持ちたい。
    * メンター（Gemini）には、技術的な選択肢の提示、設計に関するアドバイス、問題解決のヒントなど、思考を深めるサポートを期待。

---

## 3. アーキテクチャと開発計画

### 3.1. 基本設計
* **マニフェストバージョン**: Manifest V3
* **メイン処理**: `background.js` (Service Worker) で制御
* **PDFテキスト抽出**: `offscreen.js` と `pdf.js` を利用
* **ファイル名生成**: Gemini API を活用

### 3.2. 今後の開発タスク
1.  **GitHubリポジトリの作成**:
    * **目的**: Chromeウェブストアでの公開に必須となるプライバシーポリシーをウェブ上に掲載するため。
    * **アクション**: プロジェクトファイルをアップロードし、リポジトリを公開する。
2.  **通知機能の改善 (中長期的課題)**:
    * **課題**: `chrome.notifications` を利用したデスクトップ通知の動作が不安定な場合がある。（成功する場合としない場合がある）
    * **アクション**: 原因を特定し、安定した通知機能を実現する。（優先度: 低）
3.  **エラーハンドリングの強化 (完了)**:
    * **課題**: APIキーが未設定の場合、ユーザーに状態が伝わりにくい。
    * **アクション**: APIキーが未設定の場合に、クエリパラメータを利用して設定ページ (`popup.html`) へ自動的に遷移させ、理由を提示する機能を実装した。

---

## 4. 開発ログ (Changelog)

### 2025年7月4日 (金)

* **✅ 達成したこと**
    * **GitHub公開準備 (進行中)**
        * Chromeウェブストア公開に向け、Git for WindowsをPCにインストール。
        * ローカルのプロジェクトフォルダに `git init` を実行し、Gitリポジトリを初期化。
* **💡 学び・気づき**
    * **Gitの基本**:
        * `git init` コマンドは、対象のフォルダに `.git` という管理ファイル（台帳）を作成し、そのフォルダをGitの管理下に置く（リポジトリ化する）ための初期化コマンドであること。

### 2025年6月30日 (月)

* **✅ 達成したこと**
    * **タスク1: APIキーの安全な管理 (完了)**
        * Popup画面 (`popup.html`, `popup.js`) を作成し、`manifest.json`を更新して表示。
        * Popupで入力されたAPIキーを `chrome.storage.local` に保存し、`background.js` から読み込むように変更。
        * Popupから `systemPrompt` も設定できるように機能を追加。
    * **タスク2: PDF読み込みページ数の柔軟化 (完了)**
        * Popup画面にPDF読み込みページ数を指定するUIを追加し、`chrome.storage.local` に保存・読み込みするよう実装。
        * `background.js` と `offscreen.js` を修正し、指定されたページ数分のテキストを抽出するように変更。
    * **UI/UXの改善**
        * 拡張機能の実行方法をアイコンクリックでの直接開始に変更。
        * 設定画面をオプションページ (`options_page`) として分離。
        * 処理状態（開始、成功、失敗、要設定）をユーザーにフィードバックするため、アイコンバッジ（テキスト・色）を表示する機能を追加。
    * **公開準備**
        * `LICENSE` ファイル (MITライセンス) を作成。
        * `PRIVACY_POLICY.md` の雛形を作成。
        * `manifest.json` に拡張機能名、バージョン、説明、著者情報などを追記。
        * `manifest.json` に `"storage"`, `"notifications"` パーミッションと、アイコン関連の設定を追加。

* **💡 学び・気づき**
    * *(注: 以下の項目は、メンターからのヒントや解説を基に、自身で調査・実装する中で理解が深まった点です)*
    * **Chrome拡張機能の基本**:
        * Popup (`default_popup`) とオプションページ (`options_page`) の役割と挙動の違い。
        * `chrome.storage.local` を使ったデータ永続化 (`set`/`get`) と、複数項目をまとめて扱う方法。
        * 値が存在しない場合のデフォルト値の扱い方 (`storedData.key || defaultValue`)。
        * `chrome.action.setBadgeText` と `chrome.action.setBadgeBackgroundColor` を使った動的なフィードバック方法。
        * `chrome.notifications` APIの利用には `"notifications"` パーミッションと、アイコンリソースの `web_accessible_resources` 登録が必要であること。
    * **DOM操作**:
        * `document.getElementById`, `addEventListener` 等を用いた基本的なDOM操作。
        * HTMLの `<input>`, `<textarea>`, `<button>` タグの基本的な使い方。
    * **デバッグとツール**:
        * Google CLI の `replace` ツールは、対象文字列が完全に一致しないと機能しない場合がある (`No changes detected.`)。複雑な修正は、ファイル全体を読み込んでから上書きする方が確実。
        * `Uncaught SyntaxError: Illegal return statement` のようなエラーは、コードの不適切な配置（例: トップレベルでの `return`）が原因で発生しうること。
        * サービスワーカーのコンソールでのエラー確認の重要性。
    * **公開要件**:
        * Chromeウェブストアでの公開には、オンラインでアクセス可能なプライバシーポリシーページのURLが必須であること。
        * ライセンス（例: MIT）を明記することの重要性。

---

## 5. 運用ルール

* 一日の作業の終わり、またはキリの良いタイミングで、この `GEMINI.md` を更新する。
* 記録する内容は以下の通り。
    * その日の達成事項
    * 新たに出てきたアイデアや設計の変更点
    * 技術的な判断や、その背景にあるトレードオフ
    * あなたが新たに学んだこと、理解が深まったこと